<!DOCTYPE HTML>
<html>
  <head>
    <title>Forge</title>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js" integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
    <script src="js/jquery.layout-latest.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script> -->

    <!-- Minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!-- Minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />

    <!-- Optional Theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" />  

    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous" /> -->
  </head> 
  <body>
    <div id="container" class="content">
      <!-- Center Pane : Render View -->
      <div id="renderer-container" class="ui-layout-center">
        <div id="tabs-container">
        </div>
      </div>
      <!-- Left Pane -->
      <div class="ui-layout-west" style="overflow: hidden; padding-right:0px;">
        <div id="tabs-explorer" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;">
          
        </div>
      </div>
    </div>


    <div id="modal-grant-access" class="modal-grant-access-wrapper">
      <div class="modal-grant-access">
        <div class="modal-content-wrapper">
          <h1>Grant Access</h1>
          <p>Please grant this application access to your game install directory to continue.</p>
        </div>
        <div class="modal-button-wrapper">
          <button id="btn-grant-access" class="modal-button grant">Grant Access</button>
          <button id="btn-quit" class="modal-button quit">Quit</button>
        </div>
      </div>
    </div>

    <!-- Classes -->
    <script type="text/javascript" src="../KotOR.js"></script>
    <script>
    'use strict';
    $.fn.selector = { split: function() { return ""; }};

    ;(function($) {
      // multiple plugins can go here
      (function(pluginName) {
        var defaults = {
          title: 'New Window'
        };
        $.fn[pluginName] = function(options) {
          options = $.extend(true, {}, defaults, options);

          console.log('windowPane');
                
          return this.each(function() {
            var elem = this,
              $elem = $(elem);

            console.log('windowPane', $elem);

            $elem.removeClass('windowpane').addClass('windowpane');

            elem.$title = $('<div class="windowpane-title" />');
            elem.$content = $('<div class="windowpane-content" />');

            elem.$title.append('<b>'+options.title+'</b>');

            elem.dragging = false;
            elem.offset = {x:0, y:0};

            elem.$title.on('mousedown', function(e) {
              elem.dragging = true;
              let offset = $elem.offset();
              elem.offset.x = e.pageX - offset.left;
              elem.offset.y = e.pageY - offset.top;
            });

            elem.$title.on('mouseup', function(e) {
              elem.dragging = false;
            });

            $elem.on('mousemove', function(e) {
              if(elem.dragging){
                let offset = $elem.parent().offset();
                $elem.css({
                  left: e.pageX - elem.offset.x - offset.left,
                  top: e.pageY - elem.offset.y - offset.top,
                  bottom: 'initial',
                  right: 'initial',
                });
              }
            });

            $elem.append(elem.$title);
            $elem.append(elem.$content);
            
          });
        };
        $.fn[pluginName].defaults = defaults;
      })('windowPane');
    })(jQuery);

    // const explorerTabManager = new EditorTabManager();
    // const tabManager = new EditorTabManager();

    // const projectExplorerTab = new ProjectExplorerTab();
    // const resourceExplorerTab = new ResourceExplorerTab();

    // explorerTabManager.AttachTo($('#tabs-explorer'));

    // explorerTabManager.AddTab(resourceExplorerTab);
    // explorerTabManager.AddTab(projectExplorerTab);

    // resourceExplorerTab.Show();

    // $('#container').layout({
    //   applyDefaultStyles: false,
    //   west__spacing_open:		8,		// no resizer-bar when open (zero height)
    //   west__spacing_closed:		14,		// big resizer-bar when open (zero height)
    //   'onopen': (pane) => {
    //     switch(pane){
    //       case 'west':
    //         Config.options.Panes.left.open = true;
    //       break;
    //       case 'east':
    //         Config.options.Panes.right.open = true;
    //       break;
    //     }
    //     Config.save(null, true);
    //   },
    //   'onclose': (pane) => {
    //     switch(pane){
    //       case 'west':
    //         Config.options.Panes.left.open = false;
    //       break;
    //       case 'east':
    //         Config.options.Panes.right.open = false;
    //       break;
    //     }
    //     Config.save(null, true);
    //   },
    //   'onresize_end': (pane) => {
    //     //Make sure the ModuleEditorTab canvas is updated on resize
    //     tabManager.TriggerResize();
    //     /*switch(pane){
    //       case 'center':
    //         //Make sure the ModuleEditorTab canvas is updated on resize
    //         tabManager.TriggerResize();
    //       break;
    //     }*/
    //   }
    // });

    // window.addEventListener('resize', () => {
    //   try{
    //     //tabManager.TriggerResize();
    //   }catch(e){
    //     console.error(e);
    //   }
    // });

    // if(!Config.options.Panes.left.open)
    //   $('#container').layout().close('west');
    // if(!Config.options.Panes.right.open)
    //   $('#container').layout().close('east');

    // if(!app_profile){
    //   alert('Fatal Error: Window Profile Corrupted');
    //   window.close();
    // }

    // function initialize(){
    //   initMonaco().then( () => {
    //     verifyGame({
    //       directory: app_profile.directory,
    //       onVerify: () => {
    //         initializeProfile();
    //       },
    //       onError: () => {
    //         console.log('Failed to verify the path for', GameKey);
    //         dialog.showOpenDialog({title: 'Locate Game Directory', properties: ['openDirectory', 'createDirectory']}).then(result => {
    //           console.log(result.canceled);
    //           console.log(result.filePaths);
    //           if(result.filePaths.length && !result.canceled){
    //             Config.set(['Profiles', app_profile.key, 'directory'], result.filePaths[0]);
    //             app_profile = Config.get(['Profiles', app_profile.key]);
    //             initializeProfile();
    //           }else{
    //             alert('Can\'t continue without locating the game directory');
    //             window.close();
    //           }

    //         }).catch(err => {
    //           alert(err);
    //           window.close();
    //         });

    //       }
    //     });
    //   });
    // }

    // function initializeProfile(){
    //   localStorage.setItem('gameKey', GameKey);
    //   $('body').removeClass('KOTOR').removeClass('TSL').addClass(GameKey);
    //   loader.Show();
    //   GameInitializer.Init({
    //     game: Games[GameKey],
    //     onLoad: () => {
    //       AuroraWalkMesh.Init();
    //       LightManager.toggleLightHelpers(Config.get('Game.debug.light_helpers') ? true : false);
          
    //       resourceExplorerTab.initialize( () => {

    //         loadMaps( () => {

    //           if(GameKey == 'TSL'){
    //             window.iniConfig = new INIConfig(path.join(app_profile.directory, 'swkotor2.ini'));
    //           }else{
    //             window.iniConfig = new INIConfig(path.join(app_profile.directory, 'swkotor.ini'));
    //           }

    //           loader.Hide();
    //           tabManager.AddTab(new QuickStartTab());
    //           tabManager.AttachTo($('#renderer-container #tabs-container'));

    //           let pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat };
    //           Game.depthTarget = new THREE.WebGLRenderTarget( window.innerWidth, window.innerHeight, pars );
    //           Game.depthTarget.texture.generateMipmaps = false;
    //           Game.depthTarget.stencilBuffer = false;
    //           Game.depthTarget.depthBuffer = true;
    //           Game.depthTarget.depthTexture = new THREE.DepthTexture();
    //           Game.depthTarget.depthTexture.type = THREE.UnsignedShortType;

    //           ScriptEditorTab.InitNWScriptLanguage();
              

    //         });

    //       });

    //     }
    //   });
    // }

    // function loadMaps( onComplete = null ){
    //   loader.SetMessage('Loading Maps...');
    //   window.GameMaps = [];
    //   fs.readdir(path.join(app_profile.directory, 'modules'), (err, files) => {

    //     if(err){
    //       if(typeof onComplete === 'function')
    //         onComplete();
    //       return;
    //     }
        
    //     let module_loop = new AsyncLoop({
    //       array: files,
    //       onLoop: (file, asyncLoop) => {

    //         let file_parts = file.split('.');
    //         let ext = file_parts.pop();
            
    //         if(ext == 'rim'){

    //           new RIMObject(path.join(app_profile.directory, 'modules', file), (module_rim) => {
                
    //             module_rim.getRawResource('module', ResourceTypes['ifo'], (ifo) => {
    //               let area_name = new GFFObject(ifo).GetFieldByLabel('Mod_Entry_Area').GetValue();
    //               module_rim.getRawResource(area_name, ResourceTypes['are'], (are) => {
    //                 let map_name = new GFFObject(are).GetFieldByLabel('Name').GetValue();

    //                 window.GameMaps.push({name: map_name, module: file})

    //                 asyncLoop._Loop();

    //               });
    //             }, () => {
    //               asyncLoop._Loop();
    //             });

    //           });

    //         }else{
    //           asyncLoop._Loop();
    //         }

    //       }
    //     });
    //     module_loop.iterate(() => {
    //       if(typeof onComplete === 'function')
    //         onComplete();
    //     });

    //   });
    // }

    // function verifyGame(args = {}){

    //   args = $.extend({
    //     directory: null,
    //     onVerify: null,
    //     onError: null
    //   }, args);

    //   if(args.directory != null){
    //     try {
    //       fs.accessSync(args.directory, fs.F_OK);
    //       if(typeof args.onVerify == 'function')
    //         args.onVerify();
    //     } catch (e) {
    //       Config.set(['Profiles', app_profile.key, 'directory'], null);
    //       if(typeof args.onError == 'function')
    //         args.onError();
    //     }
    //   }else{
    //     Config.set(['Profiles', app_profile.key, 'directory'], null);
    //     if(typeof args.onError == 'function')
    //         args.onError();
    //   }

    // }

    // function initMonaco(){
    //   return new Promise( (resolve, reject) => {
    //     if(typeof monaco === 'undefined'){
    //       console.log('monaco: loading');
    //       amdRequire(['vs/editor/editor.main'], () => {
    //         console.log('monaco: loaded');
    //         resolve();
    //       });
    //     }else{
    //       resolve();
    //     }
    //   });
    // }

    // initialize();

    // window.canUnload = false;

    // // window.onbeforeunload = (e) => {
    // //   if(!window.canUnload)
    // //     console.log('I do not want to be closed');
    // //
    // //   //let closeDialog = new Dialog();
    // //
    // //   // Unlike usual browsers that a message box will be prompted to users, returning
    // //   // a non-void value will silently cancel the close.
    // //   // It is recommended to use the dialog API to let the user confirm closing the
    // //   // application.
    // //   e.returnValue = true;//window.canUnload;
    // // };


    </script>
  </body>
</html>